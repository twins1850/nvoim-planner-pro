# 🧪 AI 추천 시스템 테스트 가이드

## 📋 테스트 준비사항

### ✅ 사전 체크리스트

- [ ] Supabase 프로젝트 접속 가능
- [ ] 플래너 계정으로 로그인 가능
- [ ] 테스트용 학생 데이터 1명 이상
- [ ] OpenAI API 키 발급 완료
- [ ] 앤보임 레벨테스트 결과표 이미지 준비

---

## 🚀 Step 1: 데이터베이스 마이그레이션 실행

### 방법 1: Supabase Dashboard에서 실행 (권장)

1. **Supabase Dashboard** 접속
   - https://supabase.com/dashboard

2. **프로젝트 선택**
   - 앤보임 플래너 프로 프로젝트 클릭

3. **SQL Editor** 열기
   - 좌측 사이드바 > **SQL Editor** 클릭

4. **마이그레이션 SQL 실행**
   - **New Query** 버튼 클릭
   - `/Users/twins/Downloads/nvoim-planer-pro/RUN_MIGRATIONS.sql` 파일 내용 복사
   - SQL Editor에 붙여넣기
   - **Run** 버튼 클릭 (Cmd+Enter 또는 Ctrl+Enter)

5. **결과 확인**
   ```
   step                          | count
   ------------------------------|------
   student_profiles 컬럼 추가     | 5
   Storage 버킷 생성             | 1
   RLS 정책 생성                 | 4
   ```

### 방법 2: Supabase CLI 사용 (로컬 개발)

```bash
# Supabase 로그인 (처음 한 번만)
supabase login

# 데이터베이스 비밀번호 설정
export SUPABASE_DB_PASSWORD="your-database-password"

# 마이그레이션 실행
supabase db push
```

---

## 🔑 Step 2: OpenAI API 키 등록

### 2-1. OpenAI API 키 발급

1. **OpenAI Platform** 접속
   - https://platform.openai.com/api-keys

2. **로그인** 또는 **회원가입**
   - Google, Microsoft 계정으로 간편 가입 가능

3. **API 키 생성**
   - 좌측 사이드바 > **API Keys** 클릭
   - **+ Create new secret key** 버튼 클릭
   - 키 이름 입력 (예: "앤보임 플래너 프로")
   - **Create secret key** 클릭

4. **API 키 복사**
   - ⚠️ **중요**: 생성된 키는 한 번만 표시됩니다!
   - 반드시 안전한 곳에 복사해두세요
   - 예: `sk-proj-...` 형식

### 2-2. 플래너 프로에 API 키 등록

1. **플래너 프로 접속**
   - http://localhost:3000 (개발 환경)
   - 또는 배포된 URL

2. **로그인**
   - 플래너 계정으로 로그인

3. **설정 > API 키 메뉴**
   - 좌측 사이드바 > **설정** 클릭
   - **API 키** 메뉴 클릭

4. **새 API 키 추가**
   - **+ 새 API 키 추가** 버튼 클릭
   - 다음 정보 입력:
     - **API 제공자**: OpenAI 선택
     - **키 이름**: 예) "내 OpenAI 키"
     - **API 키**: 발급받은 키 붙여넣기 (sk-proj-...)
   - **저장** 버튼 클릭

5. **등록 확인**
   - API 키 목록에 추가된 키 표시
   - **활성화** 상태 확인 (초록색 토글)

---

## 👨‍🎓 Step 3: 테스트 학생 데이터 준비

### 3-1. 기존 학생 선택 또는 새 학생 추가

1. **학생 관리 메뉴**
   - 좌측 사이드바 > **학생 관리** 클릭

2. **테스트용 학생 선택**
   - 기존 학생 1명 클릭
   - 또는 **+ 학생 추가** 버튼으로 새 학생 생성

### 3-2. 레벨테스트 이미지 업로드

1. **기본 정보 탭**
   - 학생 상세 페이지에서 **기본 정보** 탭 클릭

2. **수정 모드 진입**
   - 우측 상단 **수정** 버튼 클릭

3. **레벨테스트 정보 섹션**
   - 페이지를 아래로 스크롤
   - **레벨테스트 정보** 섹션 찾기

4. **이미지 업로드**
   - **레벨테스트 결과표 이미지** 업로드 버튼 클릭
   - 앤보임 레벨테스트 결과표 이미지 선택
   - 업로드 완료 후 이미지 미리보기 확인
   - **테스트 날짜**: 자동으로 오늘 날짜 입력됨 (수정 가능)

**테스트용 이미지 준비**:
- ✅ JPG, PNG 형식
- ✅ 최대 20MB
- ✅ 선명한 이미지 권장
- ✅ 그래프와 점수가 명확하게 보이는 이미지

### 3-3. 학습 목표 입력

1. **학습 목표 섹션**
   - 레벨테스트 정보 바로 아래

2. **목표 정보 입력**
   - **목표 카테고리**: 예) "토익스피킹" 선택
   - **목표 달성 희망 날짜**: 예) 2026-12-31 선택
   - **목표 상세 설명**: 예시 입력
     ```
     6개월 후 토익스피킹 Level 6 달성
     해외 비즈니스 미팅에서 자신있게 대응
     프레젠테이션 영어 실력 강화
     ```

3. **저장**
   - 우측 상단 **저장** 버튼 클릭
   - "학생 정보가 성공적으로 저장되었습니다." 알림 확인

---

## 🤖 Step 4: AI 추천 생성 테스트

### 4-1. 학습 기록 탭 이동

1. **학습 기록 탭 클릭**
   - 학생 상세 페이지 상단 탭에서 **학습 기록** 클릭

2. **AI 추천 과정 섹션 확인**
   - 페이지 상단에 보라색 배경의 "AI 추천 과정" 섹션 표시

### 4-2. AI 추천 생성

1. **AI 추천 생성 버튼 클릭**
   - 우측 상단 **AI 추천 생성** 버튼 클릭
   - 버튼이 비활성화되어 있다면:
     - 레벨테스트 이미지가 업로드되었는지 확인
     - API 키가 등록되었는지 확인

2. **분석 진행 상태 확인**
   - 버튼 텍스트가 "분석 중..." 으로 변경
   - 로딩 스피너 표시
   - **예상 소요 시간**: 10-30초

3. **브라우저 콘솔 확인** (선택사항)
   - F12 키 또는 Cmd+Option+I (Mac) / Ctrl+Shift+I (Windows)
   - **Console** 탭에서 API 호출 로그 확인
   - **Network** 탭에서 `/api/courses/analyze-and-recommend` 요청 확인

### 4-3. 추천 결과 확인

#### ✅ 성공 시 표시 내용

**1. 추천 과정 카드 3개**
- 각 카드에 표시되는 정보:
  - 우선순위 배지 (1, 2, 3)
  - 매칭률 (%, 예: 95%)
  - 과정명 (예: "Business English Conversation")
  - 카테고리 · 레벨 (예: "비즈니스 · 중급")
  - 예상 기간 (예: "12주")
  - 추천 이유 (예: "회화 기초 과정을 완료하여...")

**2. AI 분석 인사이트 (추천 카드 아래)**
- **강점** (초록색 카드)
  - 학생의 강점 3가지
  - 예: "회화 실력", "발음", "실전 응용력"

- **개선 영역** (노란색 카드)
  - 보완이 필요한 영역 3가지
  - 예: "비즈니스 용어", "고급 문법", "독해력"

- **학습 방향** (파란색 카드)
  - AI가 제안하는 학습 방향
  - 예: "실무 중심 비즈니스 영어에 집중하되, 문법 기초를 병행 학습"

#### ❌ 오류 발생 시 확인사항

**오류 메시지별 해결 방법**:

1. **"API 키가 설정되지 않았습니다"**
   - → 설정 > API 키에서 OpenAI 키 등록 확인
   - → 키가 활성화 상태인지 확인

2. **"API 키 복호화 실패"**
   - → Supabase Edge Function `manage-api-keys` 배포 확인
   - → 환경변수 `API_KEY_ENCRYPTION_KEY` 설정 확인

3. **"AI 분석 중 오류가 발생했습니다"**
   - → OpenAI API 키 유효성 확인
   - → OpenAI 계정 사용량 및 결제 정보 확인
   - → 브라우저 콘솔에서 상세 오류 메시지 확인

4. **이미지 분석 실패**
   - → 이미지가 선명하고 올바른 형식인지 확인
   - → 이미지 크기가 20MB 이하인지 확인
   - → Supabase Storage에 이미지가 업로드되었는지 확인

---

## 📊 Step 5: 데이터베이스 확인

### 5-1. 추천 데이터 저장 확인

1. **Supabase Dashboard** > **Table Editor**

2. **course_recommendations 테이블 조회**
   ```sql
   SELECT *
   FROM course_recommendations
   WHERE student_id = 'your-student-id'
     AND is_active = true
   ORDER BY priority_rank;
   ```

3. **확인사항**
   - 3개의 추천 레코드 생성
   - `priority_rank`: 1, 2, 3
   - `match_percentage`: 숫자 값 (예: 95, 87, 78)
   - `recommendation_reason`: 텍스트 입력됨
   - `strength_analysis`: 강점 3개 (쉼표로 구분)
   - `improvement_areas`: 개선 영역 3개
   - `learning_direction`: 학습 방향 텍스트

### 5-2. Storage 이미지 확인

1. **Supabase Dashboard** > **Storage**

2. **level-test-images 버킷** 클릭

3. **업로드된 이미지 확인**
   - 플래너 ID 폴더 > 이미지 파일
   - 이미지 URL 확인 가능
   - Public URL로 접근 가능 확인

---

## 🧪 추가 테스트 시나리오

### 시나리오 1: 추천 재생성

1. **목표 수정**
   - 기본 정보 탭 > 수정 모드
   - 학습 목표 변경 (예: "토익스피킹" → "해외여행")
   - 저장

2. **AI 추천 재생성**
   - 학습 기록 탭 > AI 추천 생성 클릭
   - 새로운 추천 생성 확인
   - 이전 추천과 다른 내용인지 확인

3. **DB 확인**
   - 이전 추천: `is_active = false`
   - 새 추천: `is_active = true`

### 시나리오 2: 과정 추가 버튼

1. **추천 카드의 "과정 추가" 버튼 클릭**
   - 현재는 버튼만 표시 (기능 미구현)
   - 향후 구현 예정: `student_courses` 테이블에 자동 추가

### 시나리오 3: 여러 학생 테스트

1. **학생 2-3명 추가**
   - 각각 다른 레벨테스트 결과
   - 각각 다른 학습 목표

2. **AI 추천 생성**
   - 학생별로 다른 추천이 생성되는지 확인
   - 매칭률과 추천 이유가 적절한지 확인

---

## 📈 성능 테스트

### API 응답 시간 측정

1. **브라우저 개발자 도구** > **Network** 탭

2. **AI 추천 생성** 버튼 클릭

3. **`analyze-and-recommend` 요청** 확인
   - **예상 응답 시간**: 10-30초
   - Vision API: ~5-10초
   - GPT-4o: ~5-15초
   - DB 저장: ~1초

### OpenAI API 사용량 확인

1. **OpenAI Platform** 접속
   - https://platform.openai.com/usage

2. **Usage** 페이지 확인
   - 요청 횟수
   - 토큰 사용량
   - 비용 (예상: $0.03/회)

---

## ✅ 테스트 완료 체크리스트

### 기본 기능
- [ ] 마이그레이션 성공적으로 실행
- [ ] OpenAI API 키 등록 완료
- [ ] 레벨테스트 이미지 업로드 성공
- [ ] 학습 목표 입력 및 저장 성공
- [ ] AI 추천 생성 성공 (10-30초 이내)
- [ ] 추천 카드 3개 정상 표시
- [ ] AI 인사이트 (강점, 개선, 방향) 표시

### 데이터 검증
- [ ] course_recommendations 테이블에 데이터 저장
- [ ] is_active = true 확인
- [ ] priority_rank 1, 2, 3 확인
- [ ] match_percentage 적절한 값
- [ ] Storage에 이미지 저장 확인

### 오류 처리
- [ ] API 키 없을 때 오류 메시지 표시
- [ ] 레벨테스트 없을 때 버튼 비활성화
- [ ] OpenAI API 오류 시 적절한 메시지

### 사용자 경험
- [ ] 로딩 상태 명확하게 표시
- [ ] 성공/실패 알림 메시지 표시
- [ ] 추천 결과가 이해하기 쉬움
- [ ] UI가 직관적이고 사용하기 편함

---

## 🐛 알려진 이슈 및 해결 방법

### Issue 1: "Unauthorized" 오류
**증상**: AI 추천 생성 시 401 Unauthorized 오류
**원인**: 로그인 세션 만료
**해결**: 로그아웃 후 재로그인

### Issue 2: 이미지 업로드 실패
**증상**: "이미지 업로드 중 오류가 발생했습니다" 알림
**원인**: Storage 버킷 미생성 또는 RLS 정책 문제
**해결**: RUN_MIGRATIONS.sql 재실행

### Issue 3: GPT-4o 응답 느림
**증상**: 30초 이상 응답 시간
**원인**: OpenAI API 서버 부하
**해결**: 잠시 후 재시도

---

## 📞 지원

**문제 발생 시**:
- GitHub Issues: https://github.com/your-repo/issues
- 이메일: support@nbvoim-planner.com
- 카카오톡: @앤보임플래너프로

---

**테스트 완료일**: _____________
**테스터**: _____________
**결과**: ⭐️ Pass / ❌ Fail
**비고**: _____________
