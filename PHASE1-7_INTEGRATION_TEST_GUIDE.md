# Phase 1-7 통합 테스트 가이드

**날짜**: 2026년 2월 8일
**목적**: 플래너앱과 학생앱 간 실제 상호작용 테스트

---

## 🚀 사전 준비

### 1. 앱 실행

**터미널 1 - 플래너 앱**:
```bash
cd apps/planner-web
npm run dev
```
→ http://localhost:3000

**터미널 2 - 학생 앱** (선택적):
```bash
cd apps/student
npm run web
# 또는
npm run start
```
→ http://localhost:10000

---

## 📋 Phase 1-7 통합 테스트 시나리오

### ✅ Phase 5: 대시보드 달력 테스트

#### 테스트 1-1: 대시보드 달력 표시
1. http://localhost:3000/dashboard 접속
2. **확인사항**:
   - [ ] 월별 달력 위젯 표시
   - [ ] "2026년 02월" 제목
   - [ ] 이전/다음 달 버튼
   - [ ] 수업 이벤트 표시 (파란색 배지 "N개 수업")
   - [ ] 범례 표시 ("수업 일정", "수강권 종료 예정")

#### 테스트 1-2: 월 네비게이션
1. "다음 달" 버튼 클릭 → 3월로 이동
2. "이전 달" 버튼 클릭 → 2월로 복귀
3. **확인사항**:
   - [ ] 달력 제목 변경
   - [ ] 이벤트 데이터 자동 갱신

---

### ✅ Phase 6: 학생 상세 수업 일정 달력 테스트

#### 테스트 2-1: 학생 상세 페이지 접속
1. http://localhost:3000/dashboard/students/ea03a8c4-1390-47df-83e2-79ac1712c6a3 접속
2. "수업 일정" 탭 클릭
3. **확인사항**:
   - [ ] 수강권 정보 카드 표시
     - 수강권 이름: "주2회 50분 수강권"
     - 기간: 2026.02.08 ~ 2026.03.08
     - 상태: active
     - 남은 연기권: 0회 (이전 테스트에서 2회 사용)
     - 남은 수업: 8회
   - [ ] 월별 달력 표시
   - [ ] 수업 이벤트 표시 (2/8, 2/9, 2/11)
   - [ ] 범례 (예정/완료/연기/취소/노쇼)

#### 테스트 2-2: 수업 상태별 색상 구분
1. 달력에서 각 수업 버튼 확인
2. **확인사항**:
   - [ ] 예정 (scheduled): 파란색
   - [ ] 완료 (completed): 초록색
   - [ ] 연기 (postponed): 노란색
   - [ ] 취소 (cancelled): 빨간색
   - [ ] 노쇼 (no_show): 회색

#### 테스트 2-3: 수업 상세 모달
1. 달력에서 수업 버튼 클릭
2. **확인사항**:
   - [ ] 수업 상세 모달 표시
   - [ ] 날짜: 2026년 02월 XX일 (X)
   - [ ] 시간: 14:00:00 ~ 14:50:00
   - [ ] 상태 배지 (색상 + 아이콘 + 텍스트)
   - [ ] "닫기" 버튼
   - [ ] **연기 버튼 조건**:
     - 상태가 'scheduled'이고
     - 남은 연기권 > 0일 때만 표시
     - (현재 남은 연기권 0회이므로 버튼 미표시 예상)

---

### ✅ Phase 7: 최적화 및 개선 테스트

#### 테스트 3-1: 자동 UI 갱신 (핵심 기능!)

**사전 준비**: 연기권이 남아있는 학생 또는 새 구독 생성 필요

1. 학생 상세 → 수업 일정 탭
2. 예정된 수업(파란색) 클릭
3. "연기 신청" 버튼 클릭
4. 연기 정보 입력:
   - 재수강 날짜: 자동으로 +7일 입력됨
   - 재수강 시간: 원래 시간 자동 입력
   - 연기 사유: "아픔" 선택
5. "연기 확정" 버튼 클릭
6. **확인사항** (Phase 7 핵심!):
   - [ ] 토스트 메시지 표시 (초록색, "수업이 성공적으로 연기되었습니다.")
   - [ ] 모달 자동 닫힘 (0.5초 후)
   - [ ] **달력 자동 갱신** (수동 새로고침 불필요!)
     - 원래 수업: 파란색 → 노란색 (postponed)
     - 남은 연기권: 자동 차감 (예: 2회 → 1회)
     - 새 수업: 재수강 날짜에 파란색 수업 추가

#### 테스트 3-2: 토스트 알림 시스템

**성공 토스트**:
1. 위의 연기 신청 성공 시
2. **확인사항**:
   - [ ] 화면 우측 상단에 토스트 표시
   - [ ] 초록색 배경 (bg-green-50)
   - [ ] CheckCircle 아이콘 (초록색)
   - [ ] 메시지: "수업이 성공적으로 연기되었습니다."
   - [ ] X 버튼 (수동 닫기 가능)
   - [ ] 3초 후 자동 사라짐
   - [ ] 슬라이드 인 애니메이션 (우→좌)

**실패 토스트** (선택적):
1. 연기권 소진 후 연기 시도
2. **확인사항**:
   - [ ] 빨간색 배경 (bg-red-50)
   - [ ] XCircle 아이콘 (빨간색)
   - [ ] 에러 메시지 표시

#### 테스트 3-3: 월 변경 후 데이터 유지
1. 연기 성공 후
2. "다음 달" → "이전 달" 클릭하여 월 변경
3. **확인사항**:
   - [ ] 연기된 수업 상태 유지 (노란색)
   - [ ] 새 수업 위치 유지
   - [ ] 남은 연기권 개수 정확

---

### ✅ Phase 3-4: 연기 기능 검증 (재확인)

#### 테스트 4-1: 연기권 소진 시나리오
1. 남은 연기권: 0회인 학생 선택
2. 예정된 수업 클릭
3. **확인사항**:
   - [ ] "연기 신청" 버튼 미표시
   - [ ] "닫기" 버튼만 표시

#### 테스트 4-2: 이미 연기된 수업
1. 연기 상태(노란색) 수업 클릭
2. **확인사항**:
   - [ ] "연기 신청" 버튼 미표시
   - [ ] 상태 배지: "연기" (노란색)

---

## 🔍 데이터베이스 직접 검증 (선택적)

### Supabase SQL Editor에서 확인

**1. 수강권 정보 확인**:
```sql
SELECT
  id,
  student_id,
  subscription_name,
  postponements_used,
  max_postponements,
  (max_postponements - postponements_used) AS remaining_postponements,
  total_lessons,
  completed_lessons,
  remaining_lessons,
  status
FROM subscriptions
WHERE student_id = 'ea03a8c4-1390-47df-83e2-79ac1712c6a3'
  AND status = 'active';
```

**2. 수업 일정 확인**:
```sql
SELECT
  id,
  scheduled_date,
  scheduled_start_time,
  scheduled_end_time,
  status
FROM lessons
WHERE student_id = 'ea03a8c4-1390-47df-83e2-79ac1712c6a3'
  AND scheduled_date BETWEEN '2026-02-01' AND '2026-02-28'
ORDER BY scheduled_date, scheduled_start_time;
```

**3. 연기 기록 확인**:
```sql
SELECT
  id,
  lesson_id,
  original_date,
  rescheduled_date,
  reason,
  created_at
FROM postponements
WHERE lesson_id IN (
  SELECT id FROM lessons
  WHERE student_id = 'ea03a8c4-1390-47df-83e2-79ac1712c6a3'
)
ORDER BY created_at DESC
LIMIT 5;
```

---

## 🎯 핵심 검증 포인트

### Phase 5 (대시보드 달력)
- [x] RPC 함수: `get_dashboard_calendar_events`
- [x] 컴포넌트: DashboardCalendar.tsx
- [x] 월 네비게이션 작동
- [x] 이벤트 표시

### Phase 6 (학생 상세 달력)
- [x] RPC 함수: `get_student_lesson_calendar`
- [x] 컴포넌트: StudentCalendar.tsx
- [x] 수강권 정보 표시
- [x] 수업 상태별 색상
- [x] 수업 상세 모달
- [x] 조건부 연기 버튼

### Phase 7 (최적화)
- [x] **자동 UI 갱신** (forwardRef + useImperativeHandle)
- [x] **토스트 알림** (useToast + ToastContainer)
- [x] 슬라이드 애니메이션
- [x] 에러 처리 개선

---

## 🐛 알려진 이슈 및 해결 방법

### 이슈 1: 연기 후 UI 갱신 안됨
- **증상**: 연기 성공 후에도 달력이 이전 상태 표시
- **원인**: Phase 7 이전 구현 (이제 해결됨!)
- **해결**: Phase 7에서 자동 갱신 구현
- **확인**: 연기 → 토스트 표시 → 0.5초 후 자동 갱신

### 이슈 2: 남은 연기권 개수 불일치
- **증상**: DB와 UI의 연기권 개수 차이
- **원인**: UI 캐싱
- **해결**: 달력 월 변경 또는 F5 새로고침
- **Phase 7 개선**: 자동 갱신으로 해결

### 이슈 3: 토스트 표시 안됨
- **증상**: 연기 성공 후 토스트 미표시
- **원인**: globals.css 애니메이션 미적용
- **확인**: globals.css에 `@keyframes slideIn` 존재 여부

---

## ✅ 테스트 완료 체크리스트

### 필수 테스트
- [ ] Phase 5: 대시보드 달력 표시 및 네비게이션
- [ ] Phase 6: 학생 상세 달력 표시 및 모달
- [ ] Phase 7: 자동 UI 갱신 (핵심!)
- [ ] Phase 7: 토스트 알림 (성공/실패)
- [ ] 연기권 소진 시 버튼 숨김
- [ ] 연기된 수업 버튼 숨김

### 선택적 테스트
- [ ] 데이터베이스 직접 검증
- [ ] 여러 학생으로 테스트
- [ ] 다양한 수업 상태 테스트
- [ ] 학생앱에서 변경사항 확인 (메시지, 수업 정보)

---

## 🚀 Phase 8 진행 조건

다음 항목이 모두 확인되면 Phase 8 (프로덕션 배포)로 진행:

1. ✅ Phase 5-7 구현 파일 존재 확인
2. ✅ 코드 타입 에러 없음
3. [ ] 수동 테스트 통과 (위의 필수 테스트)
4. [ ] 알려진 이슈 해결 또는 문서화

**테스트 완료 후**: Phase 8 프로덕션 배포 진행

---

**작성**: 2026년 2월 8일
**테스트 환경**: macOS, Chrome, localhost
