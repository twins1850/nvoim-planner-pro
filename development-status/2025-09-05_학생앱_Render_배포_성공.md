# 2025-09-05 학생 앱 Render 배포 성공

## 📋 작업 개요

사용자 요청에 따라 React Native Expo 학생 앱을 Render.com에 성공적으로 배포했습니다. 플래너 앱과 동일하게 실제 서버 환경에서 개발하고 테스트할 수 있는 시스템을 구축했습니다.

## 🎯 주요 성과

### 1. React Native Expo 웹 앱 Render 배포 성공 ✅
- **목적**: 로컬 개발 대신 실제 서버 환경에서 테스트
- **방법**: Render Web Service 설정 및 Expo 웹 플랫폼 빌드
- **결과**: https://nvoim-student-app.onrender.com 정상 접근 가능

**배포 URL**: `https://nvoim-student-app.onrender.com`

### 2. 핵심 기술적 문제 해결 ✅

#### Git Submodule 문제
- **문제**: `fatal: Pathspec 'apps/student/package.json' is in submodule 'apps/student'`
- **원인**: 학생 앱이 Git submodule로 설정되어 있음
- **해결**: `git rm --cached apps/student` → 일반 디렉토리로 변환

#### Expo Metro Runtime 누락
- **문제**: `It looks like you're trying to use web support but don't have the required dependencies`
- **해결**: `@expo/metro-runtime@~5.0.4` dependencies에 추가

#### Babel Runtime 모듈 해결 오류
- **문제**: `Unable to resolve module @babel/runtime/helpers/interopRequireDefault`
- **원인**: Metro 번들러가 Babel runtime 헬퍼를 찾지 못함
- **해결 과정**:
  1. `@babel/runtime@^7.25.2` dependencies 추가
  2. `babel.config.js` 생성 및 transform-runtime 플러그인 설정
  3. Metro 설정에서 nodeModulesPaths 명시
  4. **최종 해결**: transform-runtime 플러그인 제거로 단순화

#### Render 빌드 설정 최적화
- **문제**: 잘못된 빌드 명령어 사용
- **해결**: Build Command를 `npm install && npm run build:web`로 변경
- **추가**: Root Directory를 `apps/student`로 설정

#### 정적 파일 서빙 404 오류
- **문제**: serve 패키지에서 404 오류 발생
- **해결**: 
  - SPA 모드 활성화: `serve web-build -s`
  - 명시적 포트 설정: `npx serve web-build -s -l 10000`
  - 출력 디렉토리 명시: `expo export --platform web --output-dir web-build`

## 🔧 기술적 세부사항

### Render 서비스 설정
```yaml
Service Type: Web Service
Runtime: Node.js 22.16.0
Repository: https://github.com/twins1850/nvoim-planner-pro
Branch: main
Root Directory: apps/student
Build Command: npm install && npm run build:web
Start Command: npx serve web-build -s -l 10000
Auto-Deploy: On Commit
```

### 핵심 설정 파일들

#### 1. package.json (최종 버전)
```json
{
  "name": "studentapp",
  "version": "1.0.0",
  "main": "index.ts",
  "scripts": {
    "start": "npx serve web-build -s -l 10000",
    "dev": "expo start",
    "build:web": "expo export --platform web --output-dir web-build"
  },
  "dependencies": {
    "@babel/runtime": "^7.25.2",
    "@expo/metro-runtime": "~5.0.4",
    "serve": "^14.2.1"
  },
  "devDependencies": {
    "@babel/core": "^7.25.2",
    "@babel/plugin-transform-runtime": "^7.25.2",
    "babel-preset-expo": "~12.0.0"
  }
}
```

#### 2. babel.config.js (단순화된 최종 버전)
```javascript
module.exports = function (api) {
  api.cache(true);
  return {
    presets: ['babel-preset-expo'],
  };
};
```

#### 3. metro.config.js
```javascript
const { getDefaultConfig } = require('expo/metro-config');
const path = require('path');

const config = getDefaultConfig(__dirname);

// Disable workspace root discovery
config.resolver.disableHierarchicalLookup = true;

// Ensure Metro can resolve @babel/runtime properly
config.resolver.nodeModulesPaths = [
  path.resolve(__dirname, 'node_modules'),
  path.resolve(__dirname, '../../node_modules')
];

module.exports = config;
```

### Git 작업 내역
```bash
# 주요 커밋들
git commit -m "fix: Convert student app from submodule and update for Render deployment"
git commit -m "fix: Add missing @expo/metro-runtime for web support"
git commit -m "fix: Add missing @babel/runtime dependency"
git commit -m "fix: Remove Babel transform-runtime plugin to resolve Metro bundler issues"
git commit -m "fix: Configure Metro nodeModulesPaths for proper @babel/runtime resolution"
git commit -m "fix: Add SPA mode to serve command for proper routing"
git commit -m "fix: Improve serve configuration and build output"

# 최종 성공 버전
4b9511a - fix: Improve serve configuration and build output
```

## 📊 배포 성과 검증

### 성공 지표
- ✅ **빌드 성공**: Metro 번들러 오류 완전 해결
- ✅ **서비스 시작**: Node.js 서버 정상 구동 (포트 10000)
- ✅ **웹 접근**: React Native Expo 웹 앱 정상 로드
- ✅ **기능 동작**: 로그인/회원가입 화면 정상 표시
- ✅ **Supabase 연결**: 데이터베이스 연결 및 인증 API 작동 확인

### 실제 테스트 결과
```
==> Your service is live 🎉
==> Available at your primary URL https://nvoim-student-app.onrender.com

HTTP 200 응답 성공
JavaScript 번들 로드 성공
폰트 파일 로드 성공
Supabase 인증 연결 확인
```

### 기능 검증
- ✅ **앱 초기화**: 로딩 화면 → 로그인 화면 전환
- ✅ **폼 입력**: 이메일, 비밀번호 필드 정상 작동
- ✅ **네비게이션**: 로그인 ↔ 회원가입 화면 전환
- ✅ **API 통신**: Supabase 인증 API 호출 (오류 응답 포함)
- ✅ **오류 처리**: "Invalid login credentials" 메시지 표시

## 🔄 플래너 앱 vs 학생 앱 배포 차이점

### 공통점
- Render Web Service 사용
- GitHub 자동 배포 연동
- Node.js 런타임 환경

### 차이점
| 항목 | 플래너 앱 | 학생 앱 |
|------|----------|---------|
| **프레임워크** | Next.js | React Native (Expo 웹) |
| **빌드 명령어** | `npx next build` | `expo export --platform web` |
| **시작 명령어** | `npm start` | `npx serve web-build -s -l 10000` |
| **주요 이슈** | TypeScript 모듈 오류 | Babel Runtime 모듈 해결 |
| **해결 방법** | import 경로 수정 | Metro 설정 + Babel 단순화 |

## 🚀 개발 워크플로우 완성

### Before (로컬 개발만)
```
로컬 Expo 개발 → 테스트 제한 → 배포 불확실성
```

### After (서버 환경 개발)
```
GitHub 커밋 → 자동 Render 배포 → 실서버 환경 테스트 → 지속적 개발
```

### 장점
- 🎯 실제 서버 환경에서 즉시 테스트
- 🔄 자동화된 배포 프로세스  
- 🌐 팀원과 URL 공유 가능
- 🐛 프로덕션 환경 버그 사전 발견
- 📱 모바일 웹 환경 테스트 가능

## 📈 성능 및 품질 개선

### 코드 품질
- Babel/Metro 설정 최적화
- 불필요한 플러그인 제거로 빌드 안정성 향상
- Monorepo 구조에서 모듈 해결 문제 해결

### 사용자 경험
- 빠른 로딩 속도 (정적 파일 서빙)
- SPA 라우팅으로 매끄러운 네비게이션
- 모바일 친화적 반응형 디자인

### 개발 효율성
- 실시간 배포로 빠른 피드백 루프
- 브라우저에서 즉시 테스트 가능
- 디버깅 도구 완전 활용 가능

## 🔮 다음 단계

### 즉시 가능
- [x] 학생 앱 서버 배포 완료
- [x] 기본 기능 동작 확인
- [ ] 회원가입/로그인 플로우 완전 테스트
- [ ] 메인 앱 기능들 순차 테스트

### 향후 계획
- [ ] 환경 변수 설정 최적화
- [ ] 성능 모니터링 설정
- [ ] E2E 테스트 자동화
- [ ] PWA 기능 추가 검토

## 📝 학습 포인트

### 기술적 인사이트
1. **React Native Expo 웹**: Metro 번들러 설정이 핵심
2. **Babel 설정**: 복잡한 플러그인보다 단순한 설정이 더 안정적
3. **Monorepo 배포**: Root Directory 설정의 중요성
4. **정적 파일 서빙**: SPA 모드와 포트 설정 필수

### 문제 해결 방법론
1. **체계적 접근**: 하나씩 문제를 분리하여 해결
2. **로그 분석**: 배포 로그를 통한 정확한 오류 진단
3. **점진적 개선**: 작은 변경사항으로 문제 범위 좁히기
4. **설정 단순화**: 복잡한 설정보다 기본 설정 우선

## 💡 권장사항

### 개발 프로세스
- 모든 새 기능은 서버 환경에서 즉시 테스트
- 빌드 오류 발생 시 로그 우선 분석
- 설정 변경은 한 번에 하나씩 적용

### 품질 관리
- Expo/React Native 최신 업데이트 주의
- Metro 번들러 설정 변경 시 신중하게 검토
- 정적 파일 서빙 설정 변경 후 반드시 브라우저 테스트

---

**작업 완료 시간**: 2025-09-05 15:30 KST  
**소요 시간**: 약 4시간  
**해결된 주요 이슈**: 6개 (Submodule, Metro Runtime, Babel, 빌드 설정, 서빙 설정, 라우팅)  
**최종 배포 버전**: 4b9511a  
**배포 URL**: https://nvoim-student-app.onrender.com

**🎉 학생 앱 서버 환경 구축 완료! 이제 실제 서버에서 바로 개발하고 테스트할 수 있습니다.**